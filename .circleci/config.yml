version: 2
jobs:
  build:
    docker:
      - image: circleci/golang:1.13.4
    environment:
      DBMS: mysql
      DB_USER: admin
      DB_PASS: akazawayoshinori0530
      DB_PROTOCOL: tcp(akazawa-rds-database-1.cac29imkabbo.ap-northeast-1.rds.amazonaws.com:3306)
      DB_NAME: port_database?parseTime=true
      PORT: "8080"
      AWS_SES_ENDPOINT: email-smtp.us-east-1.amazonaws.com
      AWS_REGION: us-east-1
      AWS_ACCESS_KEY_ID: AKIA4VMSL72J77GUNXUU
      AWS_SECRET_KEY: 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
      FIREBASE_PATH: ~/firebase-auth.json
      SIGN_UP_PATH: https://kemper0530.com/api/fetchSignUpAccountMail
      TEST_JWT: eyJhbGciOiJSUzI1NiIsImtpZCI6ImRjMGMzNWZlYjBjODIzYjQyNzdkZDBhYjIwNDQzMDY5ZGYzMGZkZWEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vaGFuZHNvbi1maXJlYmFzZSIsImF1ZCI6ImhhbmRzb24tZmlyZWJhc2UiLCJhdXRoX3RpbWUiOjE1ODYzOTMyMzMsInVzZXJfaWQiOiJBZEVEUmw4ODNPZ3Z0UHZkeWRZR2E0WnJ3cHUxIiwic3ViIjoiQWRFRFJsODgzT2d2dFB2ZHlkWUdhNFpyd3B1MSIsImlhdCI6MTU4NjM5MzIzMywiZXhwIjoxNTg2Mzk2ODMzLCJlbWFpbCI6Inlvc2hpLmFrYXphd2EuMDUzMEBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZW1haWwiOlsieW9zaGkuYWthemF3YS4wNTMwQGdtYWlsLmNvbSJdfSwic2lnbl9pbl9wcm92aWRlciI6InBhc3N3b3JkIn19.L5csZ7mQ1Q1Af547--WAP_QWp2BetggvQeNJugzWoN1AXdj15vaUXldKpKYJU9BwVp93ISwdIRM_VDKWXAsPp6RRM9pl1LDOZja1N1bakonLwajqs0GCc1aBXgkHwYlPTBkyteWOawSrX_BhxJeoC3HT80QYjB1WBUPvF_RMH5-Y2VgFkWEt5RLcyCIzKL5UKfdkMhzV2sa9snQxYj-KijoaTwack0co8-SNZ8uo4bwTU0hIs-tFEKE-ahRJ0haGsl-BPvR3eI8bcHMTHUHWCs4u7ySLa80r0QXHP_4HFyX18I-NJMYW75PZXiwGY9CRDVdVzf_QKHQbW5cGIEwQCQ
      FIREBASE_TOKEN: ewogICAgInR5cGUiOiAic2VydmljZV9hY2NvdW50IiwKICAgICJwcm9qZWN0X2lkIjogImhhbmRzb24tZmlyZWJhc2UiLAogICAgInByaXZhdGVfa2V5X2lkIjogIjNlODlmMTgxZDJkYzMyZmVjZTYwMGM5YmYyNDViOGYwOGUxNTNiNzEiLAogICAgInByaXZhdGVfa2V5IjogIi0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLVxuTUlJRXZBSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NCS1l3Z2dTaUFnRUFBb0lCQVFDM2txTUlmUitkU0hNK1xuQmxLUmJTZzRDbnRua0VLL0M1QnlHbVczaEJPbWQzd0I1aGd1MXJqSnFySDRFNE5BZzhqT1Rrd1h0MTh3TGZVb1xua0wwbVd6ZVlHN0tFRkhkSFlqRUpEZituSDIrczR3OGJjNlVVMExkemk2Z0JsZTFYaTlWRDYwTmE2OEo2MDZLVFxuejVoRVpVUGFZRGlNQ1IyUlYxVnR1RTZxLzZ5QVc2VDJQOGFaZjJjczQ5TG5rTmpRVzIvaW1tbDhWQXhtY2NaeFxuekRHUUtTSHBuMXQxbGIrbkJZa2Eram83Y3dXMGtlSHI1UnBiK0RjWHNhc1FTbTlNQUhMaDV5akxTa3Z6UUV6S1xuanQxY0I1a29GMk9HbVl6RzRGcTlYdk1GMHU2YkhGZzFKSUkvdlREWTd4b0JBTWZITjd1VG9OZ0NNYzBzWnBKL1xuZkdOYjQ2eEJBZ01CQUFFQ2dnRUFFOFZ3MXNDM0wzYjJwb2NDekpQdm9YMkxoZjkxR09OemRyNmVGdkpjTlhFb1xuQTRKWE4zQTc3Y2g3SzRkYWV3L1dpRlhKZjBKcU42T3poRjkyWjlPcVBMRTYvRnZCN3dmRjFUNVRPeG81S21zNFxuSE5KTFJOOG42d052SUdDWDgvWmxEVkFnN0lGNDdFYXYrM0IvNjFubXdYWGNrVVNJRVRmUlJTUjFJSml4NlE4R1xuNDl3YlBYbGtPY0pkUVE3UlZCbS9aUG5nbnp6UFByK05CVk90MDlYZ2lmM3FwVW94MjZrUUMwOGlkT0IyT2I2OVxuRmtTOUpRNGVOWktWOFhSOHNlMm5yK3h6Skc3SlpDZkUwV0k1d1NOZ3RybGhhTUY3TWgzK003cXdBVSt2NW85QVxua0FvSmRnYVZvQ1dWdkZoS3l6VEF6SmdtMCtsZ2VzRVhKWWhIcHRhRGl3S0JnUUR0cTlCY2VRZWdhMVU5c1B3YlxuNm5aME5rbGZzTStUTit5RHArdVVqakw2T0IwWDJxWTRZU3JoeEhoWWNrZCtwZ3ltMktBVTcyakQvTSsrbzgwR1xuMUdXSU0zV29iZzRyY29TeDQzcDl2ZGJVTEtOd0hHVUJoTHByMHZjNDgxQjB2NHZlV1JpSENXY2R5dklHU0t0d1xuSzVjRDBQb1Y1WjQ0YW9aTHBUYUZ3RzFzZndLQmdRREZ1c3RzZHBVT1NqWjM3ZW93c0FpQ0UwOEtPZDNJNWJ6SFxuSjM4dzVDamhnRFFqR2U5Y0htcEpka1djelpSZ0pzUmhTS0JycDJESDVMa2pwQTQwTlNZY1FlTWxWYjkvU3RCc1xua0hnZjRadkkxMU9GcVhZUWdUR2VROVFwSUQrVzZ2Um9zYTZKTTFNRnZGdnNSK0hsSlNmVjFSUFdpK212b0oyUVxubE9tUy84R0hQd0tCZ0h1SW9uUnVOQmlkc1dDdmJWclZNMXlVR3U4eDU3S05qdEdmcGtOQTVoNUlyRmFKdjN2dVxuaFd0encxbTFqSk8zbXp2ZHZOY2syVCtGV0RXdXpoS09zM2RueC9BVHhDbXhER2VwNVRFV1MyTmRFRlpsYTlxdVxuTW5kNDRDY3AwTmZkOThWS2FnVkdUZUtlYWMzNlY2R21Cb2hsUnBlN0VkSWhERXlsUXdHaVV6M2hBb0dBU2xBOVxuR2lPck83YXFxQUpUN1Q2THhBOXJ1bVVyTk5FYlZTSkVER1VEOUZTUnc4dUFpWGVvN0xrMXlvdjlRdkh2QnIwY1xuQmJuZmh1RXdyL045bnlPR2trSTFFNWdabzhiRGRMb0xXN2dZSzdDNTVGZGZWeTZuTGx0QnhyOG5CeHFCQjBRWVxuVzlwZFRwK1BVTXRuWEE3TjNQRDdScnhJOU1nQjBCQVhoVGI0VGxNQ2dZQnpYV2prOGRFRTBCbzIxSnFCbklGd1xuNlBWVGp5THYxS1FjWTBtV1BCcmx4cDF1clBQWG1LanBUZkxDQ3FrRHV0dUI0c1dNSlRoMHZPdXVXb2R0NDE1aVxuVDI3SVRGUGsxajEyNjUwOUVRVkw5NHBzbjQzUFEvY1ZJQkF6Z0RsY1JOV08zVy9NYkZ2azF1WS8vOGNjS1JJcVxuaEhWNUNWT0ExVkxiUmVmU3VxRXoyZz09XG4tLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tXG4iLAogICAgImNsaWVudF9lbWFpbCI6ICJmaXJlYmFzZS1hZG1pbnNkay1tcms3a0BoYW5kc29uLWZpcmViYXNlLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAgICJjbGllbnRfaWQiOiAiMTA2MzM5OTE0OTY5MDcyMDU3MjkzIiwKICAgICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAgICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAgICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2ZpcmViYXNlLWFkbWluc2RrLW1yazdrJTQwaGFuZHNvbi1maXJlYmFzZS5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIKfQ==
    working_directory: ~/go/src/test
    steps:
      - checkout
      - run:
          name: Env Setup
          command: echo 'export PATH=/go/bin/:${PATH}' >> $BASH_ENV
      - run:
          name: base64 decode firebase file
          # ファイルに改行が含まれているので`-i`オプションを付ける
          command: echo $FIREBASE_TOKEN | base64 -di > firebase-auth.json
      - run:
          name: Go get library
          command: go get -t -v -d ./...
      - run:
          name: Go Auto Test
          command: GO_ENV=production go test -cover -v
